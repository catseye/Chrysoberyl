{# bespoke template for Chris Pressey's Lingography #}
{% extends "base.html" %}

{% macro online_buttons(thing) -%}
  {% for impl in related('implementation-of', key=thing)|sort %}
    {% if data[impl].online_locations|length > 0 %}
      {% for loc in data[impl].online_locations|sort %}
        <a class="button" href="{{ filekey(loc) }}">
          {%- if data[thing].type == 'Game' -%}
            Play
          {%- else -%}
            Try It
          {%- endif %}
          Online ({{ data[loc].medium }})</a>
      {% endfor %}
    {% endif %}
  {% endfor %}
{%- endmacro %}

{% block content %}

<h3>Languages I've Designed ({{ lingography()|length }})</h3>

{% for thing in lingography() %}
  <h4 class="list_entry">
    {{ link(thing) }}
    <small>{{ data[thing].inception_date }}</small>
  </h4>

  <div class="row-fluid">
    <div class="span8">
      {% if data[thing].description %}
        {{ md2html(data[thing].description) }}
      {% endif %}
      
      {% if data[thing].commentary %}
        {{ md2html(data[thing].commentary) }}
      {% endif %}

      {% if related('implementation_of', key=thing) %}
        <p>Implementations:</p>
        <ul>
          {% for implementation in related('implementation_of', key=thing) %}
            <li>
              <p>
                {{- link(implementation) }}
                {% if data[implementation].reference -%}
                  (the reference implementation)
                {%- endif %}
              </p>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
      {% if related('member_of', key=thing) %}
        <p>Members of {{thing}}:</p>
        <ul>
          {% for member in related('member_of', key=thing)|sort %}
            <li>
              <p>{{ link(member) }}</p>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
      {% if related('variant_of', key=thing) %}
        <p>Variants of {{thing}}:</p>
        <ul>
          {% for variant in related('variant_of', key=thing)|sort %}
            <li>
              <p>{{ link(variant) }}</p>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>

    <div class="span4">
      {% if data[thing].sample %}
        <div class="sample">{{ md2html(data[thing].sample, fixed=true) }}</div>
      {% endif %}
      {% if data[thing].sample_input %}
        <p>Input:</p>
        <div class="sample">{{ md2html(data[thing].sample_input, fixed=true) }}</div>
      {% endif %}
      {% if data[thing].sample_output %}
        <p>Output:</p>
        <div class="sample">{{ md2html(data[thing].sample_output, fixed=true) }}</div>
      {% endif %}
      {% if data[thing].sample_credit %}
        <p>This sample was written by {{ link(data[thing].sample_credit) }}</p>
      {% endif %}
      {{ online_buttons(thing) }}
    </div>
  </div>

{% endfor %}

<h3>Languages I've Implemented</h3>

<ul>
{%- for thing in data|sort -%}
  {%- if data[thing].type == 'Implementation' and
        'Chris Pressey' in data[thing].authors and
        data[data[thing].implementation_of[0]].type == 'Programming Language' and
        'Chris Pressey' not in data[data[thing].implementation_of[0]].authors and
        data[thing].development_stage not in ['idea', 'work in progress', 'abandoned', 'lost'] -%}
    <li>
      <p>
        {{ link(thing) }},
        {{ indefart(data[thing].implementation_type) }}
        for
        {{ link(data[thing].implementation_of[0]) }}
        in
        {{ link(data[thing].host_language) }}
        {% if data[thing].host_platform %}
          for {{ link(data[thing].host_platform) }}
        {% endif %}
        {% if data[thing].inception_date %}
          ({{ data[thing].inception_date }})
        {% endif %}

        {{ online_buttons(thing) }}
      </p>
      {% if data[thing].description %}
        {{ md2html(data[thing].description) }}
      {% endif %}
      {% if data[thing].commentary %}
        {{ md2html(data[thing].commentary) }}
      {% endif %}
    </li>
  {%- endif -%}
{%- endfor -%}
</ul>

{% endblock content %}
