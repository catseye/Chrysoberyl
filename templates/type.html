{% extends "base.html" %}

{% macro list_item(thing) -%}
   {%- if not get_node(get_node(thing).type).suppress_page_generation -%}
     {{- link(thing) -}}
     {%- if online_buttons(thing) -%}
       <p>{{ online_buttons(thing) }}</p>
     {%- endif -%}
   {%- else -%}
     {{- thing -}}
   {%- endif -%}
{%- endmacro %}

{% block title %}{{ plural(key) }} | Cat's Eye Technologies{% endblock title %}

{% block heading %}
  <h1>{{ plural(key) }}</h1>
{% endblock %}

{% set collected_auspices = group_by(related_items('type'), 'auspices') %}

{% block description_verbiage %}
  {%- if description -%}
    {{- md2html(description) -}}
  {%- elif collected_auspices.keys() == [None] %}
    <p>
      This is a list of {{ plural(key)|lower }} with entries in {{ link('Chrysoberyl') }}.
    </p>
  {%- endif -%}
{% endblock description_verbiage %}

{# note: some types will not use the 'index' block for this; they will instead
   put their index into the 'content' block, if they want to appear below
   any images and/or exploit maximum horizontal real estate. #}

{% block index %}
  {% for auspices, things in iteritems_sorted_within(
      collected_auspices, [
          "Cat's Eye Technologies",
          "What is this I don't even",
          "None",
      ]
  ) %}
  <div class="row-fluid">
    <div class="span6">
      {% if collected_auspices.keys() != [None] %}
        <h3>by {% if auspices == None %}Our Valued Partners{% else %}{{ auspices }}{% endif %}</h3>
      {% endif %}
      <ul>
        {%- for thing in things|sort -%}
          {% if online_buttons(thing) %}
            <li>{{ list_item(thing) }}</li>
          {% endif %}
        {%- endfor -%}
      </ul>
      <ul>
        {%- for thing in things|sort -%}
          {% if not online_buttons(thing) %}
            <li>{{ list_item(thing) }}</li>
          {% endif %}
        {%- endfor -%}
      </ul>
    </div>
  </div>
  {% endfor %}
{% endblock index %}
